- hosts: master
  gather_facts: false
  tasks:
   - name: configure master kubernetes
     become: true  
     command: "{{item}}" 
     with_items:
      - firewall-cmd --permanent --add-port=6443/tcp
      - firewall-cmd --permanent --add-port=2379-2380/tcp
      - firewall-cmd --permanent --add-port=10250/tcp
      - firewall-cmd --permanent --add-port=10251/tcp
      - firewall-cmd --permanent --add-port=10252/tcp
      - firewall-cmd --permanent --add-port=10255/tcp
      - firewall-cmd --reload
      
   - name: configure kudeadm
     become: true  
     command: "{{item}}" 
     with_items:
      - kubeadm config images pull
      - firewall-cmd --permanent --add-port=2379-2380/tcp
      - firewall-cmd --permanent --add-port=10250/tcp
      - firewall-cmd --permanent --add-port=10251/tcp
      - firewall-cmd --permanent --add-port=10252/tcp
      - firewall-cmd --permanent --add-port=10255/tcp
      - firewall-cmd --reload      
   
   - name: configure kudeadm
     become: true  
     command: kubeadm config images pull 
   
   - name: permit access to workers
     become: true
     command: "{{item}}"
     with_items:
      - firewall-cmd --permanent --add-rich-rule 'rule family=ipv4 source address=10.0.1.10/32 accept'
      - firewall-cmd --permanent --add-rich-rule 'rule family=ipv4 source address=10.0.1.11/32 accept'
      - firewall-cmd --reload
  
   - name: obtain container localhost ip
     become: true
     command: ip a 
     register: output_ip
   
   - name: debug
     debug: 
         msg: "{{output_ip.stdout_lines}}"
         
   #- name: access container to localhost  
   #  become: true  
   #   - firewall-cmd --zone=public --permanent --add-rich-rule 'rule family=ipv4 source address=172.17.0.0/16 accept'
   #   - firewall-cmd --reload
     

      
