# abrimos puertos firewall
- name: open ports
  become: true  
  ansible.posix.firewalld: 
    zone: public
    permanent: yes
    port: "{{item}}"
    state: enabled
  loop:
   - 10250/tcp
   - 8285/udp
   - 8472/udp
   - 30000-32767/tcp
 
# volvemos a cargar el firewall 
- name: reload firewall
  become: true  
  shell: "firewall-cmd --reload" 
  
# mostramos que la variable guardada en el master la veo desde el worker
- name: debug token
  become: true
  debug: msg="{{hostvars['mastercp2.westeurope.cloudapp.azure.com']['token_join'].stdout}}"
     
# ejecutamos el valor que hemos registrado del join command de master en los workers 
- name: execute join
  become: true  
  command: "{{hostvars['mastercp2.westeurope.cloudapp.azure.com']['token_join'].stdout}}"     
  ignore_errors: yes
